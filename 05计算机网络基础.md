# 第四章 计算机网络基础

## 4.1 网络体系结构

1974年，IBM第一次提出了系统网络体系结构（SVA）的概念。第一个应用了分层的方法。

### 1. OSI

开放系统互连参考模型，简称OSI模型。从低到高分别为：1⃣️物理层、2⃣️数据链路层、3⃣️网络层、4⃣️传输层、5⃣️会话层、6⃣️表示层、7⃣️应用层

（1）物理层：通过各类协议定义了网络的机械特性、电气特性、功能特性和规程特征

（2）数据链路层：应具有的功能如下：

	- 链路的建立、拆除和分离	
	- 帧定界和帧同步
	- 顺序控制
	- 差错检测、恢复
	- 链路标识、流量/拥塞控制

（3）网络层：功能有

```
- 路由选择和中继
- 激活和终止网络连接
- 链路复用
- 差错检测和恢复
- 流量/拥塞控制
```

（4）传输层：利用实现可靠的"端到端的数据传输"能实现数据"分段、传输和组装"，还能实现差错控制，流量/拥塞控制等。

（5）会话层

（6）表示层

（7）应用层

###  TCP/IP参考模型（实用）

todo 对应关系表为表格

|    OSI     |    TCP/IP    |
| :--------: | :----------: |
|   应用层   |   应用层\|   |
|   表示层   |    应用层    |
|   会话层   |   应用层\|   |
|   传输层   |    传输层    |
|   网络层   |    网际层    |
| 数据链路层 | 网络接口层\| |
|   物理层   | 网络接口层\| |

todo 各层对应协议





## 4.2 物理层

### 1. 常见的有线传输介质

同轴电缆、屏蔽双绞线、非屏蔽双绞线、光纤、无线、蓝牙等

1. 同轴电缆

$$
分类
\left\{
\begin{aligned}
    宽带同轴电缆\\ 
    基带同轴电缆
        \left\{
        \begin{aligned}
            细同轴电缆 \\
            粗同轴电缆
        \end{aligned}
        \right.
\end{aligned}
\right.
$$

2. 屏蔽双绞线，贵，100m内高达155mb/s

3. 非屏蔽双绞线：

   线序：

   - 标准568A：绿白、绿、橙白、蓝、蓝白、橙、棕白、棕
   - 标准568B：橙白、橙、绿白、蓝、蓝白、绿、棕白、棕

4. 光纤：光导纤维，分为单模光纤和多模光纤

5. 无线传输技术

   - IEEE 802.11：无线局域网标准，P95页

   - 蓝牙、3G、4G略

   - 5G：2017年12月21日，3GPP RAN会议上，5GNR首发版本公布

     LDPH长码 -> 高通

     Polar短码  -> 华为

### 2. 常见网络设备

交换机、路由器、防火墙、VPN

注：路由器工作在OSI模型的网络层



## 4.3 数据链路层

### 1. 点到点协议：

PPP、PPPoE

### 2. 局域网的数据链路层结构

802 分类：

- 逻辑链路控制LLC：无关硬件，实现流量控制（不常用）
- 媒体接入控制层MAC：硬件相关、提供硬件和LLC层的接口

#### 2.1 MAC：

功能：数据帧封装/卸装，帧的寻址和识别、帧的接受与发送，链路的管理，帧的差错控制

访问方式：CSMA/CD、令牌环、令牌总线

格式：帧由8个字段组成

| 名称     | 长度    | 备注                          |
| -------- | ------- | ----------------------------- |
| 前导字段 | 7       |                               |
| 帧起始符 | 1       | 10101011                      |
| 目的地址 | 6       |                               |
| 原地址   | 6       |                               |
| 类型     | 2       | 考试中标记为长度              |
| 数据     | 0～1500 | IP数据报，数据+填充：46～1500 |
| 填充     | 0～46   |                               |
| 校验和   | 4       |                               |

注：以太网最小帧长为64字节，是指从"目的地址带校验和"的长度

#### 2.2 MAC地址

​		也叫硬件地址，由48比特组成，厂商编号(24)+序列号(24)，在底层网络传输中，是通过物理地址来标识主机，它一般是全球唯一的。

### 3. CSMA/CD

载波监听多路访问/冲突检测，争用型介质访问控制协议。

工作原理：先监听再发送；边发送边监听；有冲突等会儿发

适合实时传输（IEEE 802.3ae采用全双工方式，放弃了CSMA/CD）

几个重要概念：多路访问、载波监听、冲突检测、退避算法（截断的二进制指数退避算法）

### 4. IEEE 802系列协议

todo IEEE802系列协议布局图

重点：IEEE802.3 以太网规范，定义了CSMA/CD标准的媒体访问控制（MAC）子层和物理层规范。P101

- 802.3z：千兆以太网，仅适用于半双工模式
- 802.3ae：万兆以太网，仅支持光纤传输
- 千兆、万兆最小帧长为512字节



## 4.4 网络层

是OSI中第三层，常见的协议有：IP、ICMP、APRP和RARP、IPv6、NAT、MNAPT

#### 1. IP协议和IP地址

- IP数据报头（以及各个部分长度和作用）

1. IPv4地址（点分十进制）

   - A类地址范围：1.0.0.0～126.255.255.255（子网8，主机位24）

     其中：私有地址：10.x.x.x

     ​            保留地址：127.x.x.x，回环地址

   - B类地址范围：128.0.0.0～191.255.255.255（子网位16，主机位16）

     其中：私有地址：172.16.0.0～172.31.255.255

     ​            保留地址：169.254.x.x。IP地址自动获取，但没有找到相应的DHCP服务，则PC从保留地址中获取一个。

   - C类地址范围：192.0.0.0～223.255.255.255（子网位24，主机位8）

     其中：私有地址：192.168.x.x

   - D类地址：244.0.0.0～239.255.255.255，不区分网络地址和主机地址，该类地址用于组播。

     其中：224.0.0.1 代表所有主机与路由器

     ​           224.0.0.2 代表所有的组播路由器

     ​           。。。略

   - E类地址：240.0.0.0～247.255.255.255，不区分

   

   几类特殊的地址：P107

   | 名称     | 格式                       | 特点                       | 可作为源地址 | 可作为目标地址 |
   | -------- | -------------------------- | -------------------------- | ------------ | -------------- |
   | 有限广播 | 255.255.255.255            |                            | x            | y              |
   | 直接广播 | 主机字段为1，如192.1.1.125 | 不被路由，送到所有主机     | x            | y              |
   | 网络地址 | 主机位全0，如192.168.1.0   | 广播被路由，转往每台pc     | x            | x              |
   | 全0地址  | 0.0.0.0                    | 表示一个子网               | y            | x              |
   | 回环地址 | 127.x.x.x                  | 表示任意主机向自己发送数据 | y            | y              |

   

#### 2. 地址规划和子网规划

#### 3. ICMP

用于IP主机和路由器之间传递控制消息。

- 报文格式：封装在IP数据报中
- 分类：差错报告报文和询问报文
- 应用：
  - ping命令：使用回送应答个会送请求报文
  - traceroute：使用时间超时报文和目的不可达报文



#### 4. ARP和RARP

地址解析协议ARP是将32位的IP地址转为48位的以太网地址，反向地址解析协议则反过来。ARP报文峰状在以太网帧中发送。

##### 4.1 ARP原理

第一步：发送ARP请求：广播方式发送ARP请求分组

第二步：ARP响应：单播形式响应

第三步：主机写入高速缓存：记录IP和MAC对应关系，有一定的生存时间

##### 4.2 ARP病毒

使用ARP欺骗手段破坏正确的关系

eg：想被攻击主机发送虚假ARP报文，目的地址为网关IP，目的MAC地址为感染木马的主机MAC地址。

还能发送大量的广播包，造成广播风暴。

##### 4.3 ARP欺骗

类似于中间人攻击

##### 4.4 发现和解决

1. 接入交换机端口绑定固定的MAC地址
2. 查看接入交换机端口异常：一个端口段时间出现多个MAC地址
3. 安装ARP防火墙
4. 发现缓存中MAC不对，执行`arp -d`清除缓存
5. 设置静态绑定



#### 5. IPv6

长度为128位，通常写作8组，每组4个16进制数。P116

- 书写规则
  - 每段起始0可以忽略
  - 全0组成可用"::"替代
- 单播地址（相比多播高位8位总是FF）
  - 全球单播地址
  - 链路本地单播地址
  - 任意播地址
  - 地区本地单播地址
  - 组播地址



#### 6. NAT、NAPT

网络地址转换，一般将私有地址转换为公网地址，实现访问公网。有助于减少IP地址枯竭

网络地址端口转换NAPT，多对一地址转换，端口不同，共享同一地址。好处：隐藏了网络内部的IP配置，节省了资源。















